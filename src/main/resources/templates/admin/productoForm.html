<!-- Fragments to be injected into fragments/admin-layout.html -->

<!-- Optional extra CSS for this page -->
<th:block th:fragment="extraCss">
    <!-- Improve dashed dropzone look on focus/drag handled via JS class toggles -->
    <!-- Tailwind utility via admin layout; only page-specific tweaks here -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; }
    </style>
    <script>
        // Nothing here; placeholder if we need to extend Tailwind colors locally
    </script>
    <!-- Utility helper classes are applied inline; no @apply since Tailwind runs via CDN -->
    
</th:block>

<!-- Main content inserted into admin layout -->
<th:block th:fragment="mainContent">
    <div class="w-full">
        <!-- Keep generous left padding since sidebar sits at the left in admin layout -->
        <div class="max-w-5xl 2xl:max-w-6xl mx-auto">
            <div class="mb-6">
                <h1 class="text-2xl md:text-3xl font-semibold text-gray-900">Add New Product</h1>
            </div>

            <form th:action="@{/admin/productos/guardar}" method="post" enctype="multipart/form-data" class="space-y-6">
                <!-- Product Name -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-5">
                    <label for="nombre" class="text-sm font-medium text-gray-700 block mb-2">Product Name</label>
                    <input id="nombre" name="nombre" type="text" placeholder="Enter product name" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                </div>

                <!-- Description -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-5">
                    <label for="descripcion" class="text-sm font-medium text-gray-700 block mb-2">Description</label>
                    <textarea id="descripcion" name="descripcion" placeholder="Enter product description" class="w-full min-h-[110px] px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-y"></textarea>
                </div>

                <!-- Price -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-5">
                    <label for="precio" class="text-sm font-medium text-gray-700 block mb-2">Price</label>
                    <div class="relative">
                        <input id="precio" name="precio" type="number" step="0.01" min="0" placeholder="Enter product price" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent pr-10">
                        <span class="absolute inset-y-0 right-0 flex items-center pr-3 text-gray-500">$
                        </span>
                    </div>
                </div>

                <!-- Image Upload -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-5">
                    <div class="border-2 border-dashed border-gray-300 rounded-xl p-8 text-center dropzone" id="dropzone">
                        <p class="text-sm font-medium text-gray-700">Upload Product Image</p>
                        <p class="text-xs text-gray-500 mt-1">Click or drag an image here to upload</p>
                        <input id="imagen" name="imagen" type="file" accept="image/*" class="hidden" />
                        <button type="button" id="btnUpload" class="mt-4 inline-flex items-center px-4 py-2 rounded-lg bg-gray-200 hover:bg-gray-300 text-gray-800 text-sm font-medium">Upload Image</button>

                        <!-- Preview -->
                        <div id="preview" class="mt-4 hidden">
                            <img id="previewImg" alt="Preview" class="mx-auto w-40 h-40 object-cover rounded-lg shadow"/>
                            <p id="previewName" class="mt-2 text-xs text-gray-600"></p>
                        </div>
                    </div>
                </div>

                <!-- Associated School -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-5">
                    <label for="colegioId" class="text-sm font-medium text-gray-700 block mb-2">Associated School</label>
                    <div class="relative">
                        <select id="colegioId" name="colegioId" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none pr-10">
                            <option value="" selected disabled>Select School</option>
                            <option th:each="col : ${colegios}" th:value="${col.id}" th:text="${col.nombre}">Colegio de ejemplo</option>
                        </select>
                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3 text-gray-500">
                            <svg class="w-4 h-4" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M10 12a1 1 0 01-.707-.293l-4-4a1 1 0 111.414-1.414L10 9.586l3.293-3.293a1 1 0 111.414 1.414l-4 4A1 1 0 0110 12z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Available Sizes -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-5">
                    <p class="text-sm font-medium text-gray-700 mb-3">Available Sizes</p>
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                        <label class="flex items-center gap-2 text-sm text-gray-700">
                            <input type="checkbox" name="tallas" value="S" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            <span>S</span>
                        </label>
                        <label class="flex items-center gap-2 text-sm text-gray-700">
                            <input type="checkbox" name="tallas" value="M" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            <span>M</span>
                        </label>
                        <label class="flex items-center gap-2 text-sm text-gray-700">
                            <input type="checkbox" name="tallas" value="L" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            <span>L</span>
                        </label>
                        <label class="flex items-center gap-2 text-sm text-gray-700">
                            <input type="checkbox" name="tallas" value="XL" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            <span>XL</span>
                        </label>
                    </div>
                </div>

                <!-- Actions -->
                <div class="flex items-center justify-end gap-3 pt-2">
                    <a th:href="@{/admin}" class="inline-flex items-center px-4 py-2 rounded-lg border border-gray-300 text-gray-700 bg-white hover:bg-gray-50">Cancel</a>
                    <button type="submit" class="inline-flex items-center px-5 py-2.5 rounded-lg bg-yellow-500 hover:bg-yellow-600 text-white font-medium">Save</button>
                </div>
            </form>
        </div>
    </div>
</th:block>

<!-- Extra JS for this page -->
<th:block th:fragment="extraJs">
    <script>
        (function(){
            const dz = document.getElementById('dropzone');
            const fileInput = document.getElementById('imagen');
            const btn = document.getElementById('btnUpload');
            const previewWrap = document.getElementById('preview');
            const previewImg = document.getElementById('previewImg');
            const previewName = document.getElementById('previewName');

            if(!dz || !fileInput) return;

            const openPicker = () => fileInput.click();
            const showPreview = (file) => {
                if(!file) return;
                const url = URL.createObjectURL(file);
                previewImg.src = url;
                previewName.textContent = file.name + ` (${Math.round(file.size/1024)} KB)`;
                previewWrap.classList.remove('hidden');
            };

            const addDragStyles = () => dz.classList.add('border-yellow-500','bg-yellow-50','ring-2','ring-yellow-400');
            const removeDragStyles = () => dz.classList.remove('border-yellow-500','bg-yellow-50','ring-2','ring-yellow-400');
            ['dragenter','dragover'].forEach(evt => dz.addEventListener(evt, e => { e.preventDefault(); e.stopPropagation(); addDragStyles(); }));
            ['dragleave','drop'].forEach(evt => dz.addEventListener(evt, e => { e.preventDefault(); e.stopPropagation(); removeDragStyles(); }));
            dz.addEventListener('drop', e => { const f = e.dataTransfer?.files?.[0]; if(f){ fileInput.files = e.dataTransfer.files; showPreview(f); }});
            dz.addEventListener('click', openPicker);
            btn?.addEventListener('click', openPicker);
            fileInput.addEventListener('change', () => showPreview(fileInput.files?.[0]));
        })();
    </script>
</th:block>
